---
title: "e) Making Runge and Mara Figure 28.3"
author: "Nathan Brouwer"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```



## Introduction

Figure 28.3 is a 3D surface showing the equilibrium population size (xxx) as the amount of high-qualty "source" breeding habitat and high-equality winter habitat varies.




Load the package
```{r}
library(FACavian)
```


## Making Figure 28.3 the easy way


As inputs the runFAC_multi() takes a dataframe with two or more parameters varied.  In Figure 28.3 summer and winter carrying capacities are varied systematically across a rnage of values.  This range is set up using two functions,  param_ranges() and param_seqs().  param_ranges() sets the end points of the range, and param_seqs() generates  the intervening values between the endpoints to actually input into the model.

The defaults for runFAC_multi() are set to run param_ranges() and param_seqs() behind the scenes to  reproduce Figure 28.3 in Runge and Marra paper (2004).  The data underlying the figure can therefore be generated just by calling runFAC_multi().  Below, I'll first show how to quickly create the figure using the defaults.  I'll then gradually show how the functions work.

### Making Figure 28.3 automatically

```{r}
F28_3 <- runFAC_multi()
```

This produces a list; on of the elements of this list is as dataframe multiFAC.out.df.RM, which contains all the equilibirum population sizes which make up the figure.

This dataframe can be plotted with a the function plot_Fig28_3().

```{r}
par(mfrow = c(1,1))
plot_Fig28_3(F28_3$multiFAC.out.df.RM)
```


### Make Figure 28.3: details on the easy way

The param_ranges() functions has a figure = ... arguement that allows you to specify a particular figure to generate.

```{r}
F28.3.range <- param_ranges(figure = 28.3)
```

Note that K.bc and K.wg both vary from 1 to 1000.
```{r}
head(F28.3.range)
```

Once the endpoints of the ranges are set param_seqs() generates the intervening values.

```{r}
F28.3.seq <- param_seqs(F28.3.range)
```

We can see some of the fixed and also the varying parameters here
```{r}
head(F28.3.seq)
```

These vectors are then transformed into a "grid" of all possible combinations using param_grid()
```{r}
F28.3.grid <- param_grid(param.seqs = F28.3.seq)
```

This produces a big matrix
```{r}
dim(F28.3.grid)
```

We can get a peak at the variation here.
```{r}
head(F28.3.grid[,c(1:5)],12)
```

Once the grid is generated we can plug it into runFAC_multi() the param.grid = ... arguement of runFAC_multi().
```{r, eval = F}
F28_3 <-runFAC_multi(param.grid = F28.3.grid)
```

The output is then plotted as above using plot_Fig28_3().

## Make Figure 28.3: Step-by-step instructions

To make Figure 28.3 de novo we need specify more information in param_ranges().  This function takes as its arguements all the parameters in the model.  We want to work with K.bc (carrying capacity of breeding "source" habitat) and K.wg. (carrying capacity of good winter habitat).

```{r}
F28.3.range <- param_ranges(K.bc. = c(1,1000),
                            K.wg. = c(1,1000))
```

We can then proceed as before with param_seqs() and param_grid() to generate the necessary dataframe.
```{r}
F28.3.seq <- param_seqs(F28.3.range)
F28.3.grid <- param_grid(param.seqs = F28.3.seq)
```

We then run the model and plot it
```{r}
F28_3 <-runFAC_multi(param.grid = F28.3.grid)
plot_Fig28_3(F28_3$multiFAC.out.df.RM)
```


## Comparing output of FACavian to the original 

